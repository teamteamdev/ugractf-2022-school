# Случай в парикмахерской: Write-up

Подслушанное _кое-что ещё_ — ни что иное как перехват данных, звучавших в эфире вайфай-сети.

Из легенды и обрывков речи мы знаем, что её пароль — номер городского телефона в Липецке, записанный, начиная с восьмёрки, после которой следует код города (номер без кода был бы слишком коротким для пароля — 6 символов при минимальных 8). Иначе говоря, пароль имеет вид `84742??????`. Неизвестны 6 цифр, это всего миллион вариантов.

Для анализа трафика беспроводных сетей существует набор утилит под общим названием _aircrack-ng_. Главная из них, собственно _aircrack-ng_, позволяет при наличии перехваченной сессии аутентификации («четырёхстороннее рукопожатие» по протоколу EAPOL) перебирать возможные пароли со скоростью порядка нескольких тысяч вариантов в секунду (то есть нескольких миллионов в час). Мало-мальски хорошо защищённую сеть так не сломать, однако совсем уж ненадёжный — или известный частично — пароль таким образом вполне можно подобрать.

Создадим словарь возможных вариантов и запустим перебор (выберем ту сеть, для которой у нас есть все данные).

```bash
$ for i in {84742000000..84742999999}; do echo $i >> phones.dict; done
$ aircrack-ng -w phones.dict *.cap

      [00:03:04] 769112/1000000 keys tested (4247.36 k/s) 

      Time left: 54 seconds                                     76.91%

                          KEY FOUND! [ 84742723793 ]


      Master Key     : 02 4D 38 20 4B 64 22 D5 0B 0B 79 F2 93 41 0E 66 
                       3B 9A 57 64 26 E1 68 9E A5 38 9E 0B 6D 2F 4E 44 

      Transient Key  : 33 D5 DB 7E D7 4A C7 00 00 00 00 00 00 00 00 00 
                       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
                       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
                       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 

      EAPOL HMAC     : C0 01 02 98 FF 24 53 FD A0 8E 33 8A F7 54 C5 2F 
```

Ближе к концу перебор нашёл пароль — `84742723793`. Что теперь? Оказывается, зная пароль сети и умудрившись перехватить криптографический обмен, можно расшифровать трафик! Сделать это позволит входящая в тот же набор утилита _airdecap-ng_. Укажем ей известный нам теперь пароль, а также идентификаторы точки доступа.

```bash
$ airdecap-ng -p 84742723793 -b 10:62:EB:8D:2C:A5 -e DIR-825 *.cap
Total number of stations seen            2
Total number of packets read          6381
Total number of WEP data packets         0
Total number of WPA data packets      2596
Number of plaintext data packets         1
Number of decrypted WEP  packets         0
Number of corrupted WEP  packets         0
Number of decrypted WPA  packets      2572
Number of bad TKIP (WPA) packets         0
Number of bad CCMP (WPA) packets         0
```

Рядом появится ещё один .cap-файл с уже расшифрованными пакетами. Откроем его через wireshark.

Среди кучи служебного трафика, а также трафика по https, который не расшифровать никак, видим общение с неким весьма липецко-школьным на вид сайтом. Находим POST-запрос, в котором на сайт отправляется документ формата .docx. Извлекаем содержимое файла из соответствующего TCP-потока, отрезаем HTTP-заголовки и иную лишнюю информацию, открываем документ — и читаем реферат про флаг России, в котором можно заодно узнать флаг, интересующий нас в задании.

Флаг: **ugra_cracking_be_in_the_air_tonight_f7ec913ae430**
